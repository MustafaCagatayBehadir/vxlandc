<config-template xmlns="http://tail-f.com/ns/config/1.0">
    <devices xmlns="http://tail-f.com/ns/ncs">
        <device>
            <name>{$DEVICE}</name>
            <config>
                <vlan xmlns="http://tail-f.com/ned/cisco-nx">
                    <vlan-list>
                        <id>{$NETWORK_VLAN_ID}</id>
                        <name>{$NETWORK_VLAN_NAME}</name>
                        <vn-segment>{$L2VNI_ID}</vn-segment>
                    </vlan-list>
                    <?if {boolean(bd-subnet)}?>
                    <vlan-list>
                        <id>{$VRF_VLAN_ID}</id>
                        <name>{$VRF_VLAN_NAME}</name>
                        <vn-segment>{$L3VNI_ID}</vn-segment>
                    </vlan-list>
                    <?end ?>
                </vlan>
                <?if {boolean(bd-subnet)}?>
                <vrf xmlns="http://tail-f.com/ned/cisco-nx">
                    <context>
                        <id>{vrf}</id>
                        <vni>{$L3VNI_ID}</vni>
                        <rd>auto</rd>
                        <address-family>
                            <ipv4>
                                <unicast>
                                    <route-target>
                                        <method>both</method>
                                        <asn>auto</asn>
                                        <target-evpn>evpn</target-evpn>
                                    </route-target>
                                    <route-target>
                                        <method>both</method>
                                        <asn>auto</asn>
                                        <target-evpn>non-evpn</target-evpn>
                                    </route-target>
                                </unicast>
                            </ipv4>
                            <ipv6>
                                <unicast>
                                    <route-target>
                                        <method>both</method>
                                        <asn>auto</asn>
                                        <target-evpn>evpn</target-evpn>
                                    </route-target>
                                    <route-target>
                                        <method>both</method>
                                        <asn>auto</asn>
                                        <target-evpn>non-evpn</target-evpn>
                                    </route-target>
                                </unicast>
                            </ipv6>
                        </address-family>
                    </context>
                </vrf>
                <interface xmlns="http://tail-f.com/ned/cisco-nx">
                    <Vlan>
                        <name>{$NETWORK_VLAN_ID}</name>
                        <vrf>
                            <member>{vrf}</member>
                        </vrf>
                        <?foreach {bd-subnet}?>
                        <ip>
                            <?if {string(preferred) = 'yes'}?>
                            <address>
                                <ipaddr>{address}</ipaddr>
                            </address>
                            <?else ?>
                            <secondary-addr>
                                <address>
                                    <ipaddr>{address}</ipaddr>
                                    <secaddr>secondary</secaddr>
                                </address>
                            </secondary-addr>
                            <?end ?>
                        </ip>
                        <?end?>
                        <fabric>
                            <forwarding>
                                <mode>anycast-gateway</mode>
                            </forwarding>
                        </fabric>
                    </Vlan>
                </interface>
                <?end ?>
                <evpn xmlns="http://tail-f.com/ned/cisco-nx">
                    <vni>
                        <id>{$L2VNI_ID}</id>
                        <l2 />
                        <rd>auto</rd>
                        <route-target>
                            <method>import</method>
                            <rt>auto</rt>
                        </route-target>
                        <route-target>
                            <method>export</method>
                            <rt>auto</rt>
                        </route-target>
                    </vni>
                </evpn>
                <interface xmlns="http://tail-f.com/ned/cisco-nx">
                    <nve>
                        <name>1</name>
                        <member>
                            <vni>
                                <id>{$L2VNI_ID}</id>
                                <mcast-group>{mcast-group}</mcast-group>
                            </vni>
                            <?if {boolean(bd-subnet)}?>
                            <vni>
                                <id>{$L3VNI_ID}</id>
                                <associate-vrf />
                            </vni>
                            <?end ?>
                        </member>
                    </nve>
                </interface>
            </config>
        </device>
    </devices>
</config-template>